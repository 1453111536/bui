/**
 * @fileOverview \u9009\u62e9\u6846\u547d\u540d\u7a7a\u95f4\u5165\u53e3\u6587\u4ef6
 * @ignore
 */define("bui/select",function(require){var e=require("bui/common"),t=e.namespace("Select");return e.mix(t,{Select:require("bui/select/select"),Combox:require("bui/select/combox"),Suggest:require("bui/select/suggest")}),t}),define("bui/select/select",function(require){function r(e){var t=e?'<span class="checkbox"><input type="checkbox" />{text}</span>':"{text}";return'<li role="option" class="'+n+'list-item" data-value="{value}">'+t+"</li>"}var e=require("bui/common"),t=require("bui/list"),n=e.prefix,i=e.Component,s=t.Picker,o=n+"select-input",u=i.Controller.extend({initializer:function(){var e=this,t=e.get("children"),i=e.get("multipleSelect"),o=new s({children:[{elCls:n+"select-list",items:e.get("items"),itemTpl:r(i),multipleSelect:i}],valueField:e.get("valueField")});i&&o.set("hideEvent",""),e.set("picker",o)},renderUI:function(){var e=this,t=e.get("picker"),n=e.get("el"),r=n.find("."+e.get("inputCls"));t.set("trigger",n),t.set("triggerEvent",e.get("triggerEvent")),t.set("autoSetValue",e.get("autoSetValue")),t.set("textField",r),t.set("width",n.outerWidth()),t.render()},bindUI:function(){var e=this,t=e.get("multipleSelect"),n=e._getList();n.on("selectedchange",function(n){if(t){var r=$(n.domTarget),i=r.find("input");i.attr("checked",n.selected)}e.fire("change",{item:n.item})})},containsElement:function(e){var t=this,n=t.get("picker");return i.Controller.prototype.containsElement.call(this,e)||n.containsElement(e)},_uiSetItems:function(e){var t=this,n=t.get("picker"),r=n.get("list"),i=t.get("valueField");r.set("items",e),i&&n.setSelectedValue($(i).val())},_uiSetName:function(e){var t=this,n=t._getTextEl();e&&n.attr("name",e)},_uiSetWidth:function(e){var t=this;if(e!=null){var n=t._getTextEl(),r=t.get("el").find(".x-icon"),i=n.outerWidth()-n.width(),s=t.get("picker"),o=e-r.outerWidth()-i;n.width(o),s.set("width",e)}},_getTextEl:function(){var e=this,t=e.get("el");return t.find("."+e.get("inputCls"))},destructor:function(){var e=this,t=e.get("picker");t&&t.destroy()},_getList:function(){var e=this,t=e.get("picker"),n=t.get("list");return n},getSelectedValue:function(){var e=this,t=e._getList(),n=t.getSelection(),r=[];for(var i=0;i<n.length;i++)r.push(n[i].value);return r.join(",")},setSelectedValue:function(e){var t=this,n=t.get("picker");n.setSelectedValue(e)},getSelectedText:function(){var e=this,t=e._getList(),n=t.getSelection(),r=[];for(var i=0;i<n.length;i++)r.push(n[i].text);return r.join(",")}},{ATTRS:{picker:{},valueField:{},focusable:{value:!0},multipleSelect:{value:!1},name:{},items:{value:[]},inputCls:{value:o},events:{value:{change:!1}},tpl:{view:!0,value:'<input type="text" readonly="readonly" class="'+o+'"/><span class="x-icon x-icon-normal"><span class="x-caret x-caret-down"></span></span>'},triggerEvent:{value:"click"}}},{xclass:"select"});return u}),define("bui/select/combox",function(require){function r(e,t,n){var r=n.get("list"),i=n.getSelectedText();i&&$(e).val(i)}var e=require("bui/common"),t=require("bui/select/select"),n=e.prefix+"combox-input",i=t.extend({renderUI:function(){var e=this,t=e.get("picker");t.get("getFunction",r)},_uiSetItems:function(t){var n=this;for(var r=0;r<t.length;r++){var s=t[r];e.isString(s)&&(t[r]={value:s,text:s})}i.superclass._uiSetItems.call(n,t)}},{ATTRS:{tpl:{view:!0,value:'<input type="text" class="'+n+'"/>'},inputCls:{value:n}}},{xclass:"combox"});return i}),define("bui/select/suggest",function(require){var e=require("bui/common"),t=require("bui/select/combox"),n=200,r="",i=[];ie=e.UA.ie;var s=t.extend({renderUI:function(){var e=this;t=e.get("picker");if(e.get("itemTpl")){var t=e.get("picker"),n=t.get("list");n.set("itemTpl",e.get("itemTpl"))}},bindUI:function(){var e=this,t=e.get("el").find("input"),n=e.get("picker"),r=n.get("list"),i=e.get("triggerEvent")==="keyup"?"keyup":"keyup click";t.on(i,function(t){e._start()})},_start:function(){var e=this;e._timer=e.later(function(){e._updateContent()},n)},_updateContent:function(){var e=this,t=e.get("data"),n=e.get("el").find("input"),r,i=e.get("picker");if(!t&&n.val()===e.get("query"))return;e.set("query",n.val()),r=n.val();if(!t&&!r)return;var s=e.get("cacheable"),o=e.get("url"),u=e.get("data");if(s&&o){var a=e.get("dataCache");a[r]!==undefined?e._handleResponse(a[r]):e._requestData()}else o?e._requestData():u&&e._handleResponse(u)},_requestData:function(){var e=this,t=e.get("el").find("input"),n={};n[t.attr("name")]=t.val(),$.ajax({url:e.get("url"),type:"post",dataType:"jsonp",data:n,success:function(t){e._handleResponse(t)},error:function(){}})},_handleResponse:function(e){var t=this,n=t._getFilterItems(e),r=t.get("picker");t.set("items",n),t.get("cacheable")&&(t.get("dataCache")[t.get("query")]=n)},_getFilterItems:function(t){var n=this,r=[],i=n.get("el").find("input"),s=i.val(),o=n.get("data");return t=t?t:[],$.each(t,function(t,n){var i=e.isString(n)?n:n.text;o?i.indexOf($.trim(s))!==-1&&r.push(i):r.push(i)}),r},later:function(e,t,n){t=t||0;var r=n?setInterval(e,t):setTimeout(e,t);return{id:r,interval:n,cancel:function(){this.interval?clearInterval(r):clearTimeout(r)}}}},{ATTRS:{data:{value:null},query:{value:r},cacheable:{value:!1},dataCache:{value:{}},itemTpl:{value:r},triggerEvent:{valueFn:function(){return this.get("data")?"click":"keyup"}},autoSetValue:{value:!1}}},{xclass:"suggest"});return s});
