/**
 * @fileOverview form \u547d\u540d\u7a7a\u95f4\u5165\u53e3
 * @ignore
 */define("bui/form",function(require){var e=require("bui/common"),t=e.namespace("Form"),n=require("bui/form/tips");return e.mix(t,{Tips:n,TipItem:n.Item,FieldContainer:require("bui/form/fieldcontainer"),Form:require("bui/form/form"),Row:require("bui/form/row"),Group:require("bui/form/fieldgroup"),HForm:require("bui/form/horizontal"),Rules:require("bui/form/rules"),Field:require("bui/form/field"),FieldGroup:require("bui/form/fieldgroup")}),t}),define("bui/form/tips",function(require){var e=require("bui/common"),t=e.prefix,n=require("bui/overlay").Overlay,r="data-tip",i=t+"form-tip-container",s=n.extend({initializer:function(){var e=this,t=e.get("render");if(!t){var n=$(e.get("trigger")).parent();e.set("render",n)}},renderUI:function(){var e=this;e.resetVisible()},resetVisible:function(){var e=this,t=$(e.get("trigger"));t.val()?e.set("visible",!1):(e.set("align",{node:$(e.get("trigger")),points:["cl","cl"]}),e.set("visible",!0))},bindUI:function(){var e=this,t=$(e.get("trigger"));e.get("el").on("click",function(){e.hide(),t.focus()}),t.on("click focus",function(){e.hide()}),t.on("blur",function(){e.resetVisible()})}},{ATTRS:{trigger:{},text:{},iconCls:{},tpl:{value:'<span class="{iconCls}"></span><span class="tip-text">{text}</span>'}}},{xclass:"form-tip"}),o=function(e){if(this.constructor!==o)return new o(e);o.superclass.constructor.call(this,e),this._init()};return o.ATTRS={form:{},items:{value:[]}},e.extend(o,e.Base),e.augment(o,{_init:function(){var t=this,n=$(t.get("form"));n.length&&(e.each($.makeArray(n[0].elements),function(e){var n=$(e).attr(r);n&&t._initFormElement(e,$.parseJSON(n))}),n.addClass(i))},_initFormElement:function(e,t){t&&(t.trigger=e);var n=this,r=n.get("items"),i=new s(t);r.push(i)},getItem:function(t){var n=this,r=n.get("items"),i=null;return e.each(r,function(e){if($(e.get("trigger")).attr("name")===t)return i=e,!1}),i},resetVisible:function(){var t=this,n=t.get("items");e.each(n,function(e){e.resetVisible()})},render:function(){var t=this,n=t.get("items");e.each(n,function(e){e.render()})},destroy:function(){var t=this,n=t.get(n);e.each(n,function(e){e.destroy()})}}),o.Item=s,o}),define("bui/form/basefield",function(require){var e=require("bui/common"),t=e.Component,n=require("bui/form/tips").Item,r=require("bui/form/valid"),i=require("bui/form/remote"),s=e.prefix+"form-field-error",o="data-error",u=t.View.extend([i.View,r.View],{renderUI:function(){var e=this,t=e.get("control");if(!t){var n=e.get("controlTpl"),r=e.getControlContainer();if(n){var t=$(n).appendTo(r);e.set("control",t)}}else e.set("controlContainer",t.parent())},clearErrors:function(){var e=this,t=e.get("msgEl");t&&(t.remove(),e.set("msgEl",null)),e.get("el").removeClass(s)},showError:function(t,n){var r=this,i=r.get("control"),o=e.substitute(n,{error:t}),u=$(o);u.appendTo(i.parent()),r.set("msgEl",u),r.get("el").addClass(s)},getControlContainer:function(){var t=this,n=t.get("el"),r=t.get("controlContainer");return r?e.isString(r)?n.find(r):r:n},getLoadingContainer:function(){return this.getControlContainer()},_uiSetName:function(e){var t=this;t.get("control").attr("name",e)}},{ATTRS:{error:{},controlContainer:{},msgEl:{},control:{}}}),a=t.Controller.extend([i,r],{initializer:function(){var e=this;e.on("afterRenderUI",function(){var t=e.get("tip");t&&(t.trigger=e.getTipTigger(),t.autoRender=!0,t=new n(t),e.set("tip",t))})},bindUI:function(){var e=this,t=e.get("validEvent"),n=e.get("changeEvent"),r=e.getInnerControl();r.is("select")&&(t="change"),r.on(t,function(){var t=e.getControlValue(r);e.validControl(t)}),r.on("focus",function(){if(!e.get("hasValid")){var t=e.getControlValue(r);e.validControl(t)}}),e.on(n,function(){e.onValid()}),e.on("remotecomplete",function(t){e._setError(t.error)})},onValid:function(){var e=this,t=e.getControlValue();t=e.parseValue(t),e.isCurrentValue(t)||(e.setInternal("value",t),e.onChange())},onChange:function(){this.fire("change")},isCurrentValue:function(e){return e==this.get("value")},_clearError:function(){this.set("error",null),this.get("view").clearErrors()},_setError:function(e){this.set("error",e),this.showErrors()},getControlValue:function(e){var t=this;return e=e||t.getInnerControl(),e.val()},getControlContainer:function(){return this.get("view").getControlContainer()},getRemoteParams:function(){var e=this,t={};return t[e.get("name")]=e.get("value"),t},setControlValue:function(e){var t=this,n=t.getInnerControl();n.val(e)},parseValue:function(e){return e},valid:function(){var e=this;e.validControl()},validControl:function(e){var t=this,n;return e=e||t.getControlValue(),preError=t.get("error"),n=t.getValidError(e),t.setInternal("hasValid",!0),n?(t._setError(n),t.fire("error",{msg:n,value:e}),preError!==n&&t.fire("validchange",{valid:!1})):(t._clearError(),t.fire("valid"),preError&&t.fire("validchange",{valid:!0})),!n},focus:function(){this.getInnerControl().focus()},change:function(){var e=this.getInnerControl();e.change()},blur:function(){this.getInnerControl().blur()},isValid:function(){var e=this;return e.get("hasValid")||e.validControl(),!e.get("error")},getError:function(){return this.get("error")},getErrors:function(){var e=this.getError();return e?[e]:[]},clearErrors:function(){var e=this;e._clearError(),e.getControlValue()!=e.get("value")&&e.setControlValue(e.get("value"))},getInnerControl:function(){return this.get("view").get("control")},getTipTigger:function(){return this.getInnerControl()},destructor:function(){var e=this,t=e.get("tip");t&&t.destroy&&t.destroy()},setInnerWidth:function(e){var t=this,n=t.getInnerControl(),r=n.outerWidth()-n.width();n.width(e-r)},_resetTip:function(){var e=this,t=e.get("tip");t&&t.resetVisible()},_uiSetValue:function(e){var t=this;t.setControlValue(e),t.get("rendered")&&(t.validControl(),t.onChange()),t._resetTip()},_uiSetDisabled:function(e){var t=this,n=t.getInnerControl();n.attr("disabled",e),t.get("rendered")&&(e&&t.clearErrors(),e||t.valid())},_uiSetWidth:function(e){var t=this;e!=null&&t.get("forceFit")&&t.setInnerWidth(e)}},{ATTRS:{hasValid:{value:!1},forceFit:{value:!1},tip:{},changeEvent:{value:"valid"},validEvent:{value:"keyup change"},name:{view:!0},showError:{view:!0,value:!0},value:{view:!0},label:{},controlContainer:{view:!0},control:{view:!0},controlTpl:{view:!0,value:'<input type="text"/>'},events:{value:{error:!1,valid:!1,change:!0,validchange:!0}},tpl:{value:"<label>{label}</label>"},xview:{value:u}},PARSER:{control:function(e){var t=e.find("input,select,textarea");return t.length?t:e},disabled:function(e){return!!e.attr("disabled")},value:function(e){var t=this,n=t.get("value");return n||(n=e.val()),n}}},{xclass:"form-field"});return a.View=u,a}),define("bui/form/textfield",function(require){var e=require("bui/form/basefield"),t=e.extend({},{xclass:"form-field-text"});return t}),define("bui/form/numberfield",function(require){var e=require("bui/form/basefield"),t=e.extend({parseValue:function(e){if(e==""||e==null)return null;if(BUI.isNumber(e))return e;var t=this,n=t.get("allowDecimals");return e=e.replace(/\,/g,""),n?parseFloat(parseFloat(e).toFixed(t.get("decimalPrecision"))):parseInt(e)},_uiSetMax:function(e){this.addRule("max",e)},_uiSetMin:function(e){this.addRule("min",e)}},{ATTRS:{max:{},min:{},decorateCfgFields:{value:{min:!0,max:!0}},validEvent:{value:"keyup change"},defaultRules:{value:{number:!0}},allowDecimals:{value:!0},decimalPrecision:{value:2},step:{value:1}}},{xclass:"form-field-number"});return t}),define("bui/form/hiddenfield",function(require){var e=require("bui/form/basefield"),t=e.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},tpl:{value:""}}},{xclass:"form-field-hidden"});return t}),define("bui/form/readonlyfield",function(require){var e=require("bui/form/basefield"),t=e.extend({},{ATTRS:{controlTpl:{value:'<input type="text" readonly="readonly"/>'}}},{xclass:"form-field-readonly"});return t}),define("bui/form/selectfield",function(require){function n(t,n,i){t.children().remove();var s=i.get("emptyText");s&&r("",s,t),e.each(n,function(e){r(e.value,e.text,t)})}function r(e,t,n){var r='<option value="'+e+'">'+t+"</option>";$(r).appendTo(n)}var e=require("bui/common"),t=require("bui/form/basefield"),i=t.extend({renderUI:function(){var e=this,t=e.get("select");if(e.get("srcNode"))return;$.isPlainObject(t)&&e._initSelect(t)},_initSelect:function(t){var n=this;e.use("bui/select",function(e){t.render=n.getControlContainer(),t.valueField=n.getInnerControl(),t.autoRender=!0,t=new e.Select(t),n.set("select",t),n.set("isCreate",!0),n.get("children").push(t),t.on("change",function(e){var r=t.getSelectedValue();n.set("value",r)})})},setItems:function(t){var r=this,i=r.get("select");if($.isPlainObject(t)){var s=[];e.each(t,function(e,t){s.push({value:t,text:e})}),t=s}if(i&&!r.get("srcNode"))i.set?i.set("items",t):i.items=t;else{var o=r.getInnerControl();o.is("select")&&n(o,t,r),r.setControlValue(r.get("value")),r.getControlValue()||r.setInternal("value","")}},setControlValue:function(e){var t=this,n=t.get("select"),r=t.getInnerControl();r.val(e),n&&n.set&&n.getSelectedValue()!==e&&n.setSelectedValue(e)},getTipTigger:function(){var e=this,t=e.get("select");return t&&t.rendered?t.get("el").find("input"):e.get("el")},_uiSetItems:function(e){e&&this.setItems(e)},setInnerWidth:function(e){var t=this,n=t.getInnerControl(),r=t.get("select"),i=n.outerWidth()-n.width();n.width(e-i),r&&r.set&&r.set("width",e)}},{ATTRS:{items:{},controlTpl:{value:'<input type="hidden"/>'},showBlank:{value:!0},emptyText:{value:"\u8bf7\u9009\u62e9"},select:{value:{}}},PARSER:{emptyText:function(e){if(!this.get("showBlank"))return"";var t=e.find("option"),n=this.get("emptyText");return t.length&&(n=$(t[0]).text()),n}}},{xclass:"form-field-select"});return i}),define("bui/form/datefield",function(require){var e=require("bui/common"),t=require("bui/form/basefield"),n=e.Date,r=require("bui/calendar").DatePicker,i=t.extend({renderUI:function(){var e=this,t=e.get("datePicker");$.isPlainObject(t)&&(t.trigger=e.getInnerControl(),t.autoRender=!0,t=new r(t),e.set("datePicker",t),e.set("isCreatePicker",!0),e.get("children").push(t)),t.get("showTime")&&e.getInnerControl().addClass("calendar-time")},bindUI:function(){var e=this,t=e.get("datePicker");t.on("selectedchange",function(t){var n=t.curTrigger;n[0]==e.getInnerControl()[0]&&e.set("value",t.value)})},setControlValue:function(t){var r=this,i=r.getInnerControl();e.isDate(t)&&(t=n.format(t,r._getFormatMask())),i.val(t)},_getFormatMask:function(){var e=this,t=e.get("datePicker");return t.get("showTime")?"yyyy-mm-dd HH:MM:ss":"yyyy-mm-dd"},parseValue:function(t){return e.isNumber(t)?new Date(t):n.parse(t)},isCurrentValue:function(e){return n.isEquals(e,this.get("value"))},_uiSetMax:function(e){this.addRule("max",e)},_uiSetMin:function(){this.addRule("min",v)}},{ATTRS:{controlTpl:{value:'<input type="text" class="calendar"/>'},defaultRules:{value:{date:!0}},max:{},min:{},value:{setter:function(t){return e.isNumber(t)?new Date(t):t}},datePicker:{value:{}},isCreatePicker:{value:!0}},PARSER:{datePicker:function(e){return e.hasClass("calendar-time")?{showTime:!0}:{}}}},{xclass:"form-field-date"});return i}),define("bui/form/checkfield",function(require){var e=require("bui/form/basefield"),t=e.extend({onValid:function(){var e=this,t=e._getControlChecked();e.setInternal("checked",t),e.fire("change"),t?e.fire("checked"):e.fire("unchecked")},_setControlChecked:function(e){var t=this,n=t.getInnerControl();n.attr("checked",!!e)},_getControlChecked:function(){var e=this,t=e.getInnerControl();return!!t.attr("checked")},_uiSetValue:function(e){},_uiSetChecked:function(e){var t=this;t._setControlChecked(e),t.get("rendered")&&t.onValid()}},{ATTRS:{validEvent:{value:"click"},checked:{value:!1},events:{value:{checked:!1,unchecked:!1}}},PARSER:{checked:function(e){return!!e.attr("checked")}}},{xclass:"form-check-field"});return t}),define("bui/form/checkboxfield",function(e){var t=e("bui/form/checkfield"),n=t.extend({},{ATTRS:{controlTpl:{view:!0,value:'<input type="checkbox"/>'},controlContainer:{value:".checkbox"},tpl:{value:'<label><span class="checkbox"></span>{label}</label>'}}},{xclass:"form-field-checkbox"});return n}),define("bui/form/radiofield",function(e){var t=e("bui/form/checkfield"),n=t.extend({bindUI:function(){var e=this,t=e.get("parent"),n=e.get("name");t&&e.getInnerControl().on("click",function(r){var i=t.getFields(n);BUI.each(i,function(t){t!=e&&t.set("checked",!1)})})}},{ATTRS:{controlTpl:{view:!0,value:'<input type="radio"/>'},controlContainer:{value:".radio"},tpl:{value:'<label><span class="radio"></span>{label}</label>'}}},{xclass:"form-field-radio"});return n}),define("bui/form/plainfield",function(require){var e=require("bui/form/basefield"),t=e.View.extend({_uiSetValue:function(e){var t=this,n=t.get("textEl"),r=t.getControlContainer(),i=t.get("renderer"),s=i?i(e):e,o=t.get("width"),u=0,a;n&&n.remove(),s=s||"&nbsp;",a=BUI.substitute(t.get("textTpl"),{text:s}),n=$(a).appendTo(r),u=n.outerWidth()-n.width(),n.width(o-u),t.set("textEl",n)}},{ATTRS:{textEl:{},value:{}}},{xclass:"form-field-plain-view"}),n=e.extend({},{ATTRS:{controlTpl:{value:'<input type="hidden"/>'},textTpl:{view:!0,value:'<span class="x-form-text">{text}</span>'},renderer:{view:!0,value:function(e){return e}},tpl:{value:""},xview:{value:t}}},{xclass:"form-field-plain"});return n}),define("bui/form/field",function(require){var e=require("bui/common"),t=require("bui/form/basefield");return e.mix(t,{Text:require("bui/form/textfield"),Date:require("bui/form/datefield"),Select:require("bui/form/selectfield"),Hidden:require("bui/form/hiddenfield"),Number:require("bui/form/numberfield"),Check:require("bui/form/checkfield"),Radio:require("bui/form/radiofield"),Checkbox:require("bui/form/checkboxfield"),Plain:require("bui/form/plainfield")}),t}),define("bui/form/valid",function(require){var e=require("bui/common"),t=require("bui/form/rules"),n=function(){};n.prototype={getErrorsContainer:function(){var t=this,n=t.get("errorContainer");return n?e.isString(n)?t.get("el").find(n):n:t.getContentElement()},showErrors:function(t){var n=this,r=n.getErrorsContainer(),i=n.get("errorTpl");n.clearErrors();if(!n.get("showError"))return;if(n.get("showOneError")){t&&t.length&&n.showError(t[0],i,r);return}e.each(t,function(e){e&&n.showError(e,i,r)})},showError:function(e,t,n){},clearErrors:function(){}};var r=function(){};return r.ATTRS={defaultRules:{value:{}},defaultMessages:{value:{}},rules:{value:{}},messages:{value:{}},validator:{},errorContainer:{view:!0},errorTpl:{view:!0,value:'<span class="x-field-error"><span class="x-icon x-icon-mini x-icon-error">!</span><label class="x-field-error-text">{error}</label></span>'},showError:{view:!0,value:!0},showOneError:{},error:{}},r.prototype={isValid:function(){},valid:function(){},validControl:function(){},validRules:function(e,n){var r=this,i=r._getValidMessages(),s=null;for(var o in e)if(e.hasOwnProperty(o)){var u=e[o];s=t.valid(o,n,u,i[o],r);if(s)break}return s},_getValidMessages:function(){var t=this,n=t.get("defaultMessages"),r=t.get("messages");return e.merge(n,r)},getValidError:function(e){var t=this,n=t.get("validator"),r=null;return r=t.validRules(t.get("defaultRules"),e)||t.validRules(t.get("rules"),e),r||(t.parseValue&&(e=t.parseValue(e)),r=n?n.call(this,e):""),r},getErrors:function(){},showErrors:function(e){var t=this,e=e||t.getErrors();t.get("view").showErrors(e)},clearErrors:function(){var t=this,n=t.get("children");e.each(n,function(e){e.clearErrors&&e.clearErrors()}),t.set("error",null),t.get("view").clearErrors()},addRule:function(e,t,n){var r=this,i=r.get("rules"),s=r.get("messages");i[e]=t,n&&(s[e]=n)},addRules:function(t,n){var r=this;e.each(t,function(e,t){var i=n?n[t]:null;r.addRule(t,e,i)})},removeRule:function(e){var t=this,n=t.get("rules");delete n[e]},clearRules:function(){var e=this;e.set("rules",{})}},r.View=n,r}),define("bui/form/groupvalid",function(require){function n(){}function r(){}var e="x-form-error",t=require("bui/form/valid");return BUI.augment(n,t.View,{showError:function(t,n,r){var i=BUI.substitute(n,{error:t}),s=$(i);s.appendTo(r),s.addClass(e)},clearErrors:function(){var t=this,n=t.getErrorsContainer();n.children("."+e).remove()}}),r.ATTRS=ATTRS=BUI.merge(!0,t.ATTRS,{events:{value:{validchange:!0,change:!0}}}),BUI.augment(r,t,{__bindUI:function(){var e=this,t="validchange change";e.on(t,function(t){var n=t.target;if(n!=this&&e.get("showError")){var r=e.isChildrenValid();r&&(e.validControl(e.getRecord()),r=e.isSelfValid()),r?e.clearErrors():e.showErrors()}})},isValid:function(){var e=this,t=e.isChildrenValid();return t&&e.isSelfValid()},valid:function(){var e=this,t=e.get("children");BUI.each(t,function(e){e.valid()})},isChildrenValid:function(){var e=this,t=e.get("children"),n=!0;return BUI.each(t,function(e){if(!e.isValid())return n=!1,!1}),n},isSelfValid:function(){return!this.get("error")},validControl:function(e){var t=this,n=t.getValidError(e);t.set("error",n)},getErrors:function(){var e=this,t=e.get("children"),n=e.get("showChildError"),r=null,i=[];return n&&BUI.each(t,function(e){e.getErrors&&(i=i.concat(e.getErrors()))}),e.isChildrenValid()&&(r=e.get("error"),r&&i.push(r)),i},_uiSetErrorTpl:function(e){var t=this,n=t.get("children");BUI.each(n,function(t){t.set("errorTpl",e)})}}),r.View=n,r}),define("bui/form/fieldcontainer",function(require){function a(e){return e.is(u)}function f(t,n){if(t!=n){if(a(t))return[t];var r=t.attr("class");if(r&&(r.indexOf(o)!==-1||r.indexOf(s)!==-1))return[t]}var i=[],u=t.children();return e.each(u,function(e){i=i.concat(f($(e),n))}),i}var e=require("bui/common"),t=require("bui/form/field"),n=require("bui/form/groupvalid"),r=e.prefix,i="form-field",s=r+i,o=r+"form-group",u="input,select,textarea",l=e.Component.View.extend([n.View]),c=e.Component.Controller.extend([n],{syncUI:function(){var t=this,n=t.getFields(),r=t.get("validators");e.each(n,function(e){var t=e.get("name");r[t]&&e.set("validator",r[t])}),e.each(r,function(e,n){if(n.indexOf("#")==0){var r=n.replace("#",""),i=t.getChild(r,!0);i&&i.set("validator",e)}})},getDecorateElments:function(){var e=this,t=e.get("el"),n=f(t,t);return n},findXClassByNode:function(t,n){return t.attr("type")==="checkbox"?i+"-checkbox":t.attr("type")==="radio"?i+"-radio":t.attr("type")==="number"?i+"-number":t.hasClass("calendar")?i+"-date":t[0].tagName=="SELECT"?i+"-select":a(t)?i:e.Component.Controller.prototype.findXClassByNode.call(this,t,n)},getRecord:function(){var t=this,n={},r=t.getFields();return e.each(r,function(r){var i=r.get("name"),s=t._getFieldValue(r);if(!n[i])n[i]=s;else if(e.isArray(n[i])&&s!=null)n[i].push(s);else if(s!=null){var o=[n[i]];o.push(s),n[i]=o}}),n},getFields:function(n){var r=this,i=[],s=r.get("children");return e.each(s,function(e){e instanceof t?(!n||e.get("name")==n)&&i.push(e):e.getFields&&(i=i.concat(e.getFields(n)))}),i},getField:function(t){var n=this,r=n.getFields(),i=null;return e.each(r,function(e){if(e.get("name")===t)return i=e,!1}),i},getFieldAt:function(e){return this.getFields()[e]},setFieldValue:function(t,n){var r=this,i=r.getFields(t);e.each(i,function(e){r._setFieldValue(e,n)})},_setFieldValue:function(n,r){if(n.get("disabled"))return;if(n instanceof t.Check){var i=n.get("value");r&&(i===r||e.isArray(r)&&e.Array.contains(i,r))?n.set("checked",!0):n.set("checked",!1)}else n.set("value",r)},getFieldValue:function(t){var n=this,r=n.getFields(t),i=[];return e.each(r,function(e){var t=n._getFieldValue(e);t&&i.push(t)}),i.length===0?null:i.length===1?i[0]:i},_getFieldValue:function(e){return e instanceof t.Check&&!e.get("checked")?null:e.get("value")},clearFields:function(){this.clearErrors(),this.setRecord({})},setRecord:function(t){var n=this,r=n.getFields();e.each(r,function(e){var r=e.get("name");n._setFieldValue(e,t[r])})},updateRecord:function(t){var n=this,r=n.getFields();e.each(r,function(e){var r=e.get("name");t.hasOwnProperty(r)&&n._setFieldValue(e,t[r])})},focus:function(){var e=this,t=e.getFields(),n=t[0];n&&n.focus()},_uiSetDisabled:function(t){var n=this,r=n.get("children");e.each(r,function(e){e.set("disabled",t)})}},{ATTRS:{record:{setter:function(e){this.setRecord(e)},getter:function(){return this.getRecord()}},validators:{value:{}},disabled:{sync:!1},isDecorateChild:{value:!0},xview:{value:l}}},{xclass:"form-field-container"});return c.View=l,c}),define("bui/form/group/base",function(require){var e=require("bui/common"),t=require("bui/form/fieldcontainer"),n=t.extend({},{ATTRS:{label:{view:!0},defaultChildClass:{value:"form-field"}}},{xclass:"form-group"});return n}),define("bui/form/group/range",function(require){function t(e,t,n){var r=e.get("allowEqual");return r?n<=t:n<t}var e=require("bui/form/group/base"),n=e.extend({},{ATTRS:{rangeText:{value:"\u5f00\u59cb\u4e0d\u80fd\u5927\u4e8e\u7ed3\u675f\uff01"},allowEqual:{value:!0},validator:{value:function(e){var n=this,r=n.getFields(),i=!0;for(var s=1;s<r.length;s++){var o=r[s],u=r[s-1],a,f;if(o&&u){a=o.get("value"),f=u.get("value");if(!t(n,a,f)){i=!1;break}}}return i?null:n.get("rangeText")}}}},{xclass:"form-group-range"});return n}),define("bui/form/group/check",function(require){function t(e){var t=e.getFieldAt(0);return t?t.get("name"):""}var e=require("bui/form/group/base"),n=e.extend({bindUI:function(){var e=this;e.on("change",function(n){var r=t(e),i=e.get("range"),s=e.getRecord(),o=s[r],u=i[1];o&&o.length>=u?e._setFieldsEnable(r,!1):e._setFieldsEnable(r,!0)})},_setFieldsEnable:function(e,t){var n=this,r=n.getFields(e);BUI.each(r,function(e){t?e.enable():e.get("checked")||e.disable()})},_uiSetRange:function(e){this.addRule("checkRange",e)}},{ATTRS:{range:{setter:function(e){if(BUI.isString(e)||BUI.isNumber(e))e=[parseInt(e)];return e}}}},{xclass:"form-group-check"});return n}),define("bui/form/group/select",function(require){function n(e){var t=[];return BUI.each(e,function(e){t.push({text:e.text,value:e.id})}),t}var e=require("bui/form/group/base"),t=BUI.Component.UIBase.Bindable,r=e.extend([t],{initializer:function(){var e=this,t=e.get("url"),n=e.get("store")||e._getStore();n.isStore||(n.autoLoad=!0,t&&(n.url=t),n=new Data.TreeStore(n),e.set("store",n))},bindUI:function(){var e=this;e.on("change",function(t){var n=t.target;if(n!=e){var r=n,i=r.get("value"),s=e._getFieldIndex(r)+1;e._valueChange(i,s)}})},onLoad:function(e){var t=this,n=e?e.node:t.get("store").get("root");t._setFieldItems(n.level,n.children)},_getStore:function(){var e=this,t=e.get("type");return t&&i[t]?i[t]:{}},_valueChange:function(e,t){var n=this,r=n.get("store");if(e){var i=r.findNode(e);if(!i)return;r.isLoaded(i)?n._setFieldItems(t,i.children):r.loadNode(i)}else n._setFieldItems(t,[])},_setFieldItems:function(e,t){var r=this,i=r.getFieldAt(e),s=n(t);i&&(i.setItems(s),r._valueChange(i.get("value"),e+1))},_getFieldIndex:function(e){var t=this,n=t.getFields();return BUI.Array.indexOf(e,n)}},{ATTRS:{type:{},store:{}}},{xclass:"form-group-select"}),i={};return r.addType=function(e,t){i[e]=t},r.addType("city",{proxy:{url:"http://lp.taobao.com/go/rgn/citydistrictdata.php",dataType:"jsonp"},map:{isleaf:"leaf",value:"text"}}),r}),define("bui/form/fieldgroup",function(require){var e=require("bui/common"),t=require("bui/form/group/base");return e.mix(t,{Range:require("bui/form/group/range"),Check:require("bui/form/group/check"),Select:require("bui/form/group/select")}),t}),define("bui/form/form",function(require){var e=require("bui/common"),t=require("bui/toolbar").Bar,n=require("bui/form/fieldcontainer"),r=e.Component,i=n.View.extend({_uiSetMethod:function(e){this.get("el").attr("method",e)},_uiSetAction:function(e){this.get("el").attr("action",e)}},{ATTRS:{method:{},action:{}}},{xclass:"form-view"}),s=n.extend({renderUI:function(){var n=this,r=n.get("buttonBar"),i;$.isPlainObject(r)&&n.get("buttons")&&(i=e.merge(n.getDefaultButtonBarCfg(),r),r=new t(i),n.set("buttonBar",r))},bindUI:function(){var e=this,t=e.get("el");t.on("submit",function(t){e.valid(),(!e.isValid()||e.onBeforeSubmit()===!1)&&t.preventDefault()})},getDefaultButtonBarCfg:function(){var e=this,t=e.get("buttons");return{autoRender:!0,elCls:"toolbar",render:e.get("el"),items:t,defaultChildClass:"bar-item-button"}},submit:function(e){var t=this;t.valid();if(t.isValid()){if(t.onBeforeSubmit()==0)return;e||t.get("el")[0].submit()}},serializeToObject:function(){return e.FormHelper.serializeToObject(this.get("el")[0])},onBeforeSubmit:function(){return this.fire("beforesubmit")},reset:function(){var e=this,t=e.get("initRecord");e.setRecord(t)},destructor:function(){var e=this,t=e.get("buttonBar");t&&t.destroy&&t.destroy()},_uiSetInitRecord:function(e){this.setRecord(e)}},{ATTRS:{action:{view:!0,value:""},allowTextSelection:{value:!0},events:{value:{beforesubmit:!1}},method:{view:!0,value:"get"},decorateCfgFields:{value:{method:!0,action:!0}},defaultChildClass:{value:"form-field"},elTagName:{value:"form"},buttons:{},buttonBar:{value:{}},childContainer:{value:".x-form-fields"},initRecord:{},showError:{value:!1},xview:{value:i},tpl:{value:'<div class="x-form-fields"></div>'}}},{xclass:"form"});return s.View=i,s}),define("bui/form/horizontal",function(require){var e=require("bui/common"),t=require("bui/form/form"),n=t.extend({getDefaultButtonBarCfg:function(){var e=this,t=e.get("buttons");return{autoRender:!0,elCls:"actions-bar toolbar row",tpl:'<div class="form-actions span21 offset3"></div>',childContainer:".form-actions",render:e.get("el"),items:t,defaultChildClass:"bar-item-button"}}},{ATTRS:{defaultChildClass:{value:"form-row"},errorTpl:{value:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'},elCls:{value:"form-horizontal"}},PARSER:{}},{xclass:"form-horizontal"});return n}),define("bui/form/row",function(require){var e=require("bui/common"),t=require("bui/form/fieldcontainer"),n=t.extend({},{ATTRS:{elCls:{value:"row"},defaultChildCfg:{value:{tpl:' <label class="control-label">{label}</label>                <div class="controls">                </div>',childContainer:".controls",showOneError:!0,controlContainer:".controls",elCls:"control-group span8",errorTpl:'<span class="valid-text"><span class="estate error"><span class="x-icon x-icon-mini x-icon-error">!</span><em>{error}</em></span></span>'}},defaultChildClass:{value:"form-field-text"}}},{xclass:"form-row"});return n}),define("bui/form/rule",function(require){function n(e,t,n,r,s){var o=e,u=o.get("validator"),a=i(e,n,r),f=!0;return t=t==null?"":t,u.call(o,t,n,a,s)}function r(t){if(t==null)return{};if($.isPlainObject(t))return t;var n=t,r={};if(e.isArray(t)){for(var i=0;i<n.length;i++)r[i]=n[i];return r}return{0:t}}function i(t,n,i){var s=r(n);return i=i||t.get("msg"),e.substitute(i,s)}var e=require("bui/common"),t=function(e){t.superclass.constructor.call(this,e)};return e.extend(t,e.Base),t.ATTRS={name:{},msg:{},validator:{value:function(e,t,n,r){}}},e.augment(t,{valid:function(e,t,r,i){var s=this;return n(s,e,t,r,i)}}),t}),define("bui/form/rules",function(require){function t(e){return parseFloat(e)}function n(e){return BUI.Date.parse(e)}function y(e,t,n){var r=e&&e.equals!==!1;return r?n<=t:n<t}function b(e){return e==""||e==null}function w(e,t,n,r){var i=r.getFields(),s=!0;for(var o=1;o<i.length;o++){var u=i[o],a=i[o-1],f,l;if(u&&a){f=u.get("value"),l=a.get("value");if(!b(f)&&!b(l)&&!y(t,f,l)){s=!1;break}}}return s?null:n}function x(e){var t=e.getFieldAt(0);return t?t.get("name"):""}function T(e,t){BUI.isArray(t)||(t=[t]);if(!e||!t.length)return!1;var n=e?BUI.isArray(e)?e.length:1:0;if(t.length==1){var r=t[0];if(!r)return!0;if(r>n)return!1}else{var i=t[0],s=t[1];if(i>n||s<n)return!1}return!0}var e=require("bui/form/rule"),r={},i={add:function(t){var n;return $.isPlainObject(t)?(n=t.name,r[n]=new e(t)):t.get&&(n=t.get("name"),r[n]=t),r[n]},remove:function(e){delete r[e]},get:function(e){return r[e]},valid:function(e,t,n,r,s){var o=i.get(e);return o?o.valid(t,n,r,s):null},isValid:function(e,t,n,r){return i.valid(e,t,n,r)==null}},s=i.add({name:"required",msg:"\u4e0d\u80fd\u4e3a\u7a7a\uff01",validator:function(e,t,n){if(t!==!1&&/^\s*$/.test(e))return n}}),o=i.add({name:"equalTo",msg:"\u4e24\u6b21\u8f93\u5165\u4e0d\u4e00\u81f4\uff01",validator:function(e,t,n){var r=$(t);return r.length&&(t=r.val()),e===t?undefined:n}}),u=i.add({name:"min",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(e,n,r){if(e!==""&&t(e)<t(n))return r}}),a=i.add({name:"max",msg:"\u8f93\u5165\u503c\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(e,n,r){if(e!==""&&t(e)>t(n))return r}}),f=i.add({name:"length",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e3a{0}\uff01",validator:function(e,t,n){if(e!=null){e=$.trim(e.toString());if(t!=e.length)return n}}}),l=i.add({name:"minlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5c0f\u4e8e{0}\uff01",validator:function(e,t,n){if(e!=null){e=$.trim(e.toString());var r=e.length;if(r<t)return n}}}),c=i.add({name:"maxlength",msg:"\u8f93\u5165\u503c\u957f\u5ea6\u4e0d\u5927\u4e8e{0}\uff01",validator:function(e,t,n){if(e){e=$.trim(e.toString());var r=e.length;if(r>t)return n}}}),h=i.add({name:"regexp",msg:"\u8f93\u5165\u503c\u4e0d\u7b26\u5408{0}\uff01",validator:function(e,t,n){if(t)return t.test(e)?undefined:n}}),p=i.add({name:"email",msg:"\u4e0d\u662f\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\uff01",validator:function(e,t,n){e=$.trim(e);if(e)return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)?undefined:n}}),d=i.add({name:"date",msg:"\u4e0d\u662f\u6709\u6548\u7684\u65e5\u671f\uff01",validator:function(e,t,n){if(BUI.isNumber(e))return;if(BUI.isDate(e))return;e=$.trim(e);if(e)return BUI.Date.isDateString(e)?undefined:n}}),v=i.add({name:"minDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e{0}\uff01",validator:function(e,t,r){if(e){var i=n(e);if(i&&i<n(t))return r}}}),m=i.add({name:"maxDate",msg:"\u8f93\u5165\u65e5\u671f\u4e0d\u80fd\u5927\u4e8e{0}\uff01",validator:function(e,t,r){if(e){var i=n(e);if(i&&i>n(t))return r}}}),g=i.add({name:"number",msg:"\u4e0d\u662f\u6709\u6548\u7684\u6570\u5b57\uff01",validator:function(e,t,n){if(BUI.isNumber(e))return;return e=e.replace(/\,/g,""),isNaN(e)?n:undefined}}),E=i.add({name:"dateRange",msg:"\u7ed3\u675f\u65e5\u671f\u4e0d\u80fd\u5c0f\u4e8e\u8d77\u59cb\u65e5\u671f\uff01",validator:w}),S=i.add({name:"numberRange",msg:"\u7ed3\u675f\u6570\u5b57\u4e0d\u80fd\u5c0f\u4e8e\u5f00\u59cb\u6570\u5b57\uff01",validator:w}),N=i.add({name:"checkRange",msg:"\u5fc5\u987b\u9009\u4e2d{0}\u9879\uff01",validator:function(e,t,n,r){var i=x(r),s,o=t;if(i&&o){s=e[i];if(!T(s,o))return n}return null}});return i}),define("bui/form/remote",function(require){var e=require("bui/common"),t=function(){};t.ATTRS={isLoading:{},loadingEl:{}},t.prototype={getLoadingContainer:function(){},_setLoading:function(){var e=this,t=e.get("loadingEl"),n=e.get("loadingTpl");t||(t=$(n).appendTo(e.getLoadingContainer()),e.setInternal("loadingEl",t))},_clearLoading:function(){var e=this,t=e.get("loadingEl");t&&(t.remove(),e.setInternal("loadingEl",null))},_uiSetIsLoading:function(e){var t=this;e?t._setLoading():t._clearLoading()}};var n=function(){};return n.ATTRS={defaultRemote:{value:{method:"GET",cache:!0,callback:function(e){return e}}},remoteDaly:{value:500},loadingTpl:{view:!0,value:'<img src="http://img02.taobaocdn.com/tps/i2/T1NU8nXCVcXXaHNz_X-16-16.gif" alt="loading"/>'},isLoading:{view:!0,value:!1},remote:{setter:function(t){return e.isString(t)&&(t={url:t}),t}},remoteHandler:{},events:{value:{remotecomplete:!1,remotestart:!1}}},n.prototype={__bindUI:function(){var e=this;e.on("change",function(t){if(e.get("remote")&&e.isValid()){var n=e.getRemoteParams();e._startRemote(n)}}),e.on("error",function(t){e.get("remote")&&e._cancelRemote()})},_startRemote:function(e){function i(){t._remoteValid(e,n),t.set("isLoading",!0)}var t=this,n=t.get("remoteHandler"),r=t.get("remoteDaly");n&&t._cancelRemote(n),n=setTimeout(i,r),t.setInternal("remoteHandler",n)},_remoteValid:function(t,n){function u(e,t){n==r.get("remoteHandler")&&(r.fire("remotecomplete",{error:e,data:t}),r.set("isLoading",!1),r.setInternal("remoteHandler",null))}var r=this,i=r.get("remote"),s=r.get("defaultRemote"),o=e.merge(s,i,{data:t});o.success=function(e){var t=o.callback,n=t(e);u(n,e)},o.error=function(e,t,n){u(n)},r.fire("remotestart",{data:t}),$.ajax(o)},getRemoteParams:function(){},_cancelRemote:function(e){var t=this;e=e||t.get("remoteHandler"),e&&(clearTimeout(e),t.setInternal("remoteHandler",null)),t.set("isLoading",!1)}},n.View=t,n});
